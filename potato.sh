#!/bin/bash

REPO_URL="https://github.com/AtomLabss/potatobot.js.git"
CONTAINER="/home/container"

update_system() {
    if [ -d "$CONTAINER" ]; then
        rm -rf "$CONTAINER"
    fi

    git clone "$REPO_URL" "$CONTAINER"
}

if [ "$1" == "--pterodactyl-auto-update=true" ]; then
    echo " "
    echo "|‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|"
    echo "|              _        _        _           _      _       |"
    echo "|  _ __   ___ | |_ __ _| |_ ___ | |__   ___ | |_   (_)___   |"
    echo "| | '_ \ / _ \| __/ _\` | __/ _ \| '_ \ / _ \| __|  | / __|  |"
    echo "| | |_) | (_) | || (_| | || (_) | |_) | (_) | |_ _ | \__ \  |"
    echo "| | .__/ \___/ \__\__,_|\__\___/|_.__/ \___/ \__(_)/ |___/  |"
    echo "| |_|                                            |__/       |"
    echo "|___________________________________________________________|"
    echo " "
    echo "-------------------------------------------------------------"
    echo "Updating system via GitHub..."
    echo "-------------------------------------------------------------"
    cd "$CONTAINER"
    update_system
    echo "-------------------------------------------------------------"
    echo "Installing and upgrading packages..."
    echo "-------------------------------------------------------------"
    cd "$CONTAINER"
    npm install
    echo "-------------------------------------------------------------"
    echo "Repairing packages..."
    echo "-------------------------------------------------------------"
    cd "$CONTAINER"
    npm audit fix
    echo "-------------------------------------------------------------"
    echo "Starting potatobot.js..."
    echo "-------------------------------------------------------------"
    node "$CONTAINER/main.js"
else
    echo " "
    echo "|‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|"
    echo "|              _        _        _           _      _       |"
    echo "|  _ __   ___ | |_ __ _| |_ ___ | |__   ___ | |_   (_)___   |"
    echo "| | '_ \ / _ \| __/ _\` | __/ _ \| '_ \ / _ \| __|  | / __|  |"
    echo "| | |_) | (_) | || (_| | || (_) | |_) | (_) | |_ _ | \__ \  |"
    echo "| | .__/ \___/ \__\__,_|\__\___/|_.__/ \___/ \__(_)/ |___/  |"
    echo "| |_|                                            |__/       |"
    echo "|___________________________________________________________|"
    echo " "
    echo "-------------------------------------------------------------"
    echo "Starting potatobot.js..."
    echo "-------------------------------------------------------------"
    node "./main.js"
fi